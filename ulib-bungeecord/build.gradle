dependencies {
    compile project(':ulib-bungeecord-api')
    compileOnly coordsWaterfall

    // annotation
    annotationProcessor coordsLombok
}

processResources {
    eachFile {
        copyDetails ->
            if (copyDetails.path == 'bungee.yml') {
                filter { line ->
                    line.replace('{{version}}', project.version)
                }
            }
    }
}

//shadowing
void itSubs(Jar task) {
    def projects = ['core', 'bungeecord-api', 'minecraft-api']
    for (String sub : projects) {
        def proj = ':ulib-' + sub

        task.dependsOn "$proj:build"

        def buildDir = project(proj).buildDir.path
        task.from("$buildDir/classes/java/main") { include '**' }
        task.from("$buildDir/resources/main") { include '**' }
    }

}

jar.finalizedBy { shadowJar }

// https://imperceptiblethoughts.com/shadow/configuration/dependencies/#configuring-shadowed-dependencies
shadowJar {
    dependsOn tasks.relocateShadowJar
    configurations = [project(':ulib-core').configurations.compileOnly]
    itSubs(shadowJar)

    archiveClassifier.set('')
    dependencies {
        exclude(dependency(coordsLombok))
    }

}